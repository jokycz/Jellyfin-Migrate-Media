<Window x:Class="JellyfinMigrateMedia.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:JellyfinMigrateMedia"
        mc:Ignorable="d"
        Title="Jellyfin migrate" Height="600" Width="1000">
    <Grid Margin="14">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <DockPanel Grid.Row="0" Margin="0,0,0,12">
            <TextBlock FontSize="18" FontWeight="SemiBold" Text="Migrace profily" DockPanel.Dock="Left"/>
            <TextBlock Foreground="Gray" DockPanel.Dock="Right" VerticalAlignment="Center"
                       Text="{Binding SettingsPath, StringFormat=Konfigurace: {0}}"/>
        </DockPanel>

        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="320"/>
                <ColumnDefinition Width="14"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left: profiles list -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="Seznam migrací" FontWeight="SemiBold" Margin="0,0,0,8"/>

                <ListBox Grid.Row="1"
                         ItemsSource="{Binding Profiles}"
                         SelectedItem="{Binding SelectedProfile}"
                         DisplayMemberPath="Name"/>

                <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,10,0,0">
                    <Button Content="Vytvořit" Width="90" Margin="0,0,8,0" Command="{Binding NewProfileCommand}"/>
                    <Button Content="Upravit" Width="90" Margin="0,0,8,0" Command="{Binding EditProfileCommand}"/>
                    <Button Content="Smazat" Width="90" Command="{Binding DeleteProfileCommand}"/>
                </StackPanel>
            </Grid>

            <!-- Right: details -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="{Binding SelectedProfile.Name, FallbackValue=Vyber migraci}" FontSize="16" FontWeight="SemiBold"/>

                <TextBlock Grid.Row="1" Margin="0,8,0,0"
                           Text="{Binding SelectedProfile.Model.Destination.TargetPath, FallbackValue=(bez cíle), StringFormat=Cíl (target): {0}}"/>

                <GroupBox Grid.Row="2" Header="Zdroje" Margin="0,12,0,0">
                    <ItemsControl ItemsSource="{Binding SelectedProfile.Model.Sources}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock>
                                    <Run Text="{Binding LibraryName, FallbackValue=Knihovna}"/>
                                    <Run Text=" "/>
                                    <Run Text="{Binding ContentType, StringFormat=({0})}"/>
                                    <Run Text=" - "/>
                                    <Run Text="{Binding SourcePath}"/>
                                </TextBlock>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </GroupBox>

                <GroupBox Grid.Row="3" Header="Stav / nalezené položky" Margin="0,12,0,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Orientation="Horizontal">
                            <TextBlock Text="{Binding FoundItemsCount, StringFormat=Nalezeno: {0} položek}" FontWeight="SemiBold"/>
                            <TextBlock Text="  "/>
                            <Button Content="Přepočítat" Width="100" Command="{Binding RefreshStatusCommand}"/>
                        </StackPanel>
                        <TextBox Grid.Row="1" Margin="0,8,0,0"
                                 Text="{Binding ScanSummary}"
                                 IsReadOnly="True"
                                 TextWrapping="Wrap"
                                 VerticalScrollBarVisibility="Auto"/>
                    </Grid>
                </GroupBox>

                <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,12,0,0">
                    <Button Content="Spustit migraci" Width="140" Command="{Binding RunProfileCommand}"/>
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</Window>
